<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Google Login</title>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
</head>

<body>
  <h2>Google ログイン中...</h2>

  <script>
    // Firebase Config 読み込み
    fetch("/auth/firebase_config.json")
      .then((response) => response.json())
      .then((config) => {
        firebase.initializeApp(config);
        const auth = firebase.auth();

        const provider = new firebase.auth.GoogleAuthProvider();

        auth.signInWithPopup(provider)
          .then((result) => {
            result.user.getIdToken().then((token) => {
              // Streamlit 本番URLにリダイレクト
              window.location.href =
                "https://haru-blog-tool-npjsqczavgftaswdkt4u24.streamlit.app/?token=" +
                token;
            });
          })
          .catch((error) => {
            document.body.innerHTML =
              "<h3>ログインに失敗しました。</h3><p>" +
              error.message +
              "</p>";
          });
      });
  </script>
</body>
</html>